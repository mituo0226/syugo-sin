<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ダッシュボード | 守護神占い</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .feature-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ヘッダー -->
    <header class="glass-effect p-4">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4">
                    <i class="fas fa-crystal-ball text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">守護神占い</h1>
                    <p class="text-white/80 text-sm">あなた専用のダッシュボード</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-white/80 text-sm" id="userEmail">読み込み中...</span>
                <button onclick="logout()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>ログアウト
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- ウェルカムメッセージ -->
        <div class="glass-effect rounded-2xl p-8 mb-8 text-center">
            <div class="text-6xl mb-4">🎉</div>
            <h2 class="text-3xl font-bold text-white mb-4">会員登録完了！</h2>
            <p class="text-white/90 text-lg">
                守護神占いの会員として登録されました。<br>
                様々な機能をご利用いただけます。
            </p>
        </div>

        <!-- ユーザー情報カード -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-bold text-white mb-4">
                <i class="fas fa-user-circle mr-2"></i>あなたの情報
            </h3>
            <div id="userInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="animate-pulse">
                    <div class="h-4 bg-white/20 rounded mb-2"></div>
                    <div class="h-4 bg-white/20 rounded mb-2"></div>
                    <div class="h-4 bg-white/20 rounded"></div>
                </div>
            </div>
        </div>

        <!-- 機能メニュー -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 占いを始める -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">🔮</div>
                <h3 class="text-xl font-bold text-white mb-2">占いを始める</h3>
                <p class="text-white/80 text-sm mb-4">
                    新しい占いを開始して、守護神からのメッセージを受け取りましょう
                </p>
                <a href="/" class="bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                    <i class="fas fa-play mr-2"></i>占い開始
                </a>
            </div>

            <!-- 守護神の言葉 -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">✨</div>
                <h3 class="text-xl font-bold text-white mb-2">守護神の言葉</h3>
                <p class="text-white/80 text-sm mb-4">
                    あなたの守護神からの特別なメッセージを確認できます
                </p>
                <a href="../ritual/ritual-guardian.html" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-eye mr-2"></i>メッセージを見る
                </a>
              </div>

              <!-- 龍の言葉 -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">🐉</div>
                <h3 class="text-xl font-bold text-white mb-2">龍の言葉</h3>
                <p class="text-white/80 text-sm mb-4">
                  神秘的な龍からの特別なアドバイスを受け取れます
                </p>
                <a href="../ritual/ritual-dragon.html" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-fire mr-2"></i>龍の言葉を聞く
                </a>
              </div>

              <!-- 相談チャット -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">💬</div>
                <h3 class="text-xl font-bold text-white mb-2">相談チャット</h3>
                <p class="text-white/80 text-sm mb-4">
                  守護神に直接相談できるチャット機能です
                </p>
                <a href="../consult/chat.html" class="bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-comments mr-2"></i>チャット開始
                </a>
              </div>

              <!-- 購入履歴 -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">📋</div>
                <h3 class="text-xl font-bold text-white mb-2">購入履歴</h3>
                <p class="text-white/80 text-sm mb-4">
                  過去の購入履歴やサービス利用状況を確認できます
                </p>
                <a href="../purchase-history.html" class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                    <i class="fas fa-history mr-2"></i>履歴を見る
                </a>
            </div>

            <!-- 設定 -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">⚙️</div>
                <h3 class="text-xl font-bold text-white mb-2">アカウント設定</h3>
                <p class="text-white/80 text-sm mb-4">
                    プロフィール情報の変更やアカウント設定を行えます
                </p>
                <button onclick="showSettings()" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200">
                    <i class="fas fa-cog mr-2"></i>設定
                </button>
            </div>
        </div>

        <!-- お知らせ -->
        <div class="glass-effect rounded-2xl p-6 mt-8">
            <h3 class="text-xl font-bold text-white mb-4">
                <i class="fas fa-bell mr-2"></i>お知らせ
            </h3>
            <div class="space-y-3">
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2">🎉 会員登録完了</h4>
                    <p class="text-white/80 text-sm">
                        守護神占いの会員として登録されました。様々な機能をご利用いただけます。
                    </p>
                </div>
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2">✨ 新機能追加</h4>
                    <p class="text-white/80 text-sm">
                        相談チャット機能が追加されました。守護神に直接相談できます。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ダッシュボードページが読み込まれました');
            loadUserInfo();
        });

        // ユーザー情報の読み込み
        async function loadUserInfo() {
            try {
                // URLパラメータからメールアドレスを取得
                const urlParams = new URLSearchParams(window.location.search);
                const email = urlParams.get('email');
                
                if (email) {
                    document.getElementById('userEmail').textContent = email;
                    
                    // ユーザー詳細情報を取得
                    const response = await fetch(`/api/save-user-profile?email=${encodeURIComponent(email)}`);
                    const data = await response.json();
                    
                    if (data.success && data.user) {
                        displayUserInfo(data.user);
                    } else {
                        displayDefaultUserInfo(email);
                    }
                } else {
                    // セッションからユーザー情報を取得（将来的な実装）
                    displayDefaultUserInfo('ゲストユーザー');
                }
            } catch (error) {
                console.error('ユーザー情報の読み込みエラー:', error);
                displayDefaultUserInfo('ゲストユーザー');
            }
        }

        // ユーザー情報の表示
        function displayUserInfo(user) {
            const userInfo = document.getElementById('userInfo');
            
            let birthdate = '未設定';
            if (user.birth_year && user.birth_month && user.birth_day) {
                birthdate = `${user.birth_year}年${user.birth_month}月${user.birth_day}日`;
            }

            userInfo.innerHTML = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-envelope text-white/70 mr-3"></i>
                        <span class="text-white"><strong>メールアドレス:</strong> ${user.user_id || '未設定'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-birthday-cake text-white/70 mr-3"></i>
                        <span class="text-white"><strong>生年月日:</strong> ${birthdate}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-crown text-white/70 mr-3"></i>
                        <span class="text-white"><strong>守護神:</strong> ${user.guardian_name || '未設定'}</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-heart text-white/70 mr-3"></i>
                        <span class="text-white"><strong>悩みの種類:</strong> ${user.worry_type || '未設定'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-calendar text-white/70 mr-3"></i>
                        <span class="text-white"><strong>登録日:</strong> ${formatDate(user.created_at)}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-400 mr-3"></i>
                        <span class="text-white"><strong>ステータス:</strong> 登録完了</span>
                    </div>
                </div>
            `;
        }

        // デフォルトユーザー情報の表示
        function displayDefaultUserInfo(email) {
            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-envelope text-white/70 mr-3"></i>
                        <span class="text-white"><strong>メールアドレス:</strong> ${email}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-info-circle text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ステータス:</strong> 会員登録済み</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-star text-yellow-400 mr-3"></i>
                        <span class="text-white"><strong>会員特典:</strong> 全機能利用可能</span>
                    </div>
                </div>
            `;
        }

        // 設定画面の表示
        function showSettings() {
            alert('設定機能は準備中です。\n\n今後のアップデートで以下の機能を追加予定です：\n• プロフィール情報の変更\n• 通知設定\n• アカウント削除');
        }

        // ログアウト機能
        function logout() {
            if (confirm('ログアウトしますか？')) {
                // ローカルストレージをクリア
                localStorage.removeItem('userData');
                
                // トップページにリダイレクト
                window.location.href = '/';
            }
        }

        // ユーティリティ関数
        function formatDate(dateString) {
            if (!dateString) return '未設定';
            return new Date(dateString).toLocaleDateString('ja-JP');
        }
    </script>
</body>
</html>