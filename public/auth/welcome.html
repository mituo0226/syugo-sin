<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | å®ˆè­·ç¥å ã„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .feature-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="glass-effect p-4">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4">
                    <i class="fas fa-crystal-ball text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">å®ˆè­·ç¥å ã„</h1>
                    <p class="text-white/80 text-sm">ã‚ãªãŸå°‚ç”¨ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-white/80 text-sm" id="userEmail">èª­ã¿è¾¼ã¿ä¸­...</span>
                <button onclick="logout()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div class="glass-effect rounded-2xl p-8 mb-8 text-center">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h2 class="text-3xl font-bold text-white mb-4">ä¼šå“¡ç™»éŒ²å®Œäº†ï¼</h2>
            <p class="text-white/90 text-lg">
                å®ˆè­·ç¥å ã„ã®ä¼šå“¡ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚<br>
                æ§˜ã€…ãªæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚
            </p>
        </div>

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚«ãƒ¼ãƒ‰ -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-bold text-white mb-4">
                <i class="fas fa-user-circle mr-2"></i>ã‚ãªãŸã®æƒ…å ±
            </h3>
            <div id="userInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="animate-pulse">
                    <div class="h-4 bg-white/20 rounded mb-2"></div>
                    <div class="h-4 bg-white/20 rounded mb-2"></div>
                    <div class="h-4 bg-white/20 rounded"></div>
                </div>
            </div>
        </div>

        <!-- æ©Ÿèƒ½ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- å ã„ã‚’å§‹ã‚ã‚‹ -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">ğŸ”®</div>
                <h3 class="text-xl font-bold text-white mb-2">å ã„ã‚’å§‹ã‚ã‚‹</h3>
                <p class="text-white/80 text-sm mb-4">
                    æ–°ã—ã„å ã„ã‚’é–‹å§‹ã—ã¦ã€å®ˆè­·ç¥ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã¾ã—ã‚‡ã†
                </p>
                <a href="/" class="bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                    <i class="fas fa-play mr-2"></i>å ã„é–‹å§‹
                </a>
            </div>

            <!-- å®ˆè­·ç¥ã®è¨€è‘‰ -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">âœ¨</div>
                <h3 class="text-xl font-bold text-white mb-2">å®ˆè­·ç¥ã®è¨€è‘‰</h3>
                <p class="text-white/80 text-sm mb-4">
                    ã‚ãªãŸã®å®ˆè­·ç¥ã‹ã‚‰ã®ç‰¹åˆ¥ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã§ãã¾ã™
                </p>
                <a href="../ritual/ritual-guardian.html" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-eye mr-2"></i>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã‚‹
                </a>
              </div>

              <!-- é¾ã®è¨€è‘‰ -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">ğŸ‰</div>
                <h3 class="text-xl font-bold text-white mb-2">é¾ã®è¨€è‘‰</h3>
                <p class="text-white/80 text-sm mb-4">
                  ç¥ç§˜çš„ãªé¾ã‹ã‚‰ã®ç‰¹åˆ¥ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å—ã‘å–ã‚Œã¾ã™
                </p>
                <a href="../ritual/ritual-dragon.html" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-fire mr-2"></i>é¾ã®è¨€è‘‰ã‚’èã
                </a>
              </div>

              <!-- ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">ğŸ’¬</div>
                <h3 class="text-xl font-bold text-white mb-2">ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ</h3>
                <p class="text-white/80 text-sm mb-4">
                  å®ˆè­·ç¥ã«ç›´æ¥ç›¸è«‡ã§ãã‚‹ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã§ã™
                </p>
                <a href="../consult/chat.html" class="bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                  <i class="fas fa-comments mr-2"></i>ãƒãƒ£ãƒƒãƒˆé–‹å§‹
                </a>
              </div>

              <!-- è³¼å…¥å±¥æ­´ -->
              <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">ğŸ“‹</div>
                <h3 class="text-xl font-bold text-white mb-2">è³¼å…¥å±¥æ­´</h3>
                <p class="text-white/80 text-sm mb-4">
                  éå»ã®è³¼å…¥å±¥æ­´ã‚„ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™
                </p>
                <a href="../purchase-history.html" class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 inline-block">
                    <i class="fas fa-history mr-2"></i>å±¥æ­´ã‚’è¦‹ã‚‹
                </a>
            </div>

            <!-- è¨­å®š -->
            <div class="feature-card glass-effect rounded-2xl p-6 text-center">
                <div class="text-4xl mb-4">âš™ï¸</div>
                <h3 class="text-xl font-bold text-white mb-2">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</h3>
                <p class="text-white/80 text-sm mb-4">
                    ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®å¤‰æ›´ã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã‚’è¡Œãˆã¾ã™
                </p>
                <button onclick="showSettings()" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200">
                    <i class="fas fa-cog mr-2"></i>è¨­å®š
                </button>
            </div>
        </div>

        <!-- ãŠçŸ¥ã‚‰ã› -->
        <div class="glass-effect rounded-2xl p-6 mt-8">
            <h3 class="text-xl font-bold text-white mb-4">
                <i class="fas fa-bell mr-2"></i>ãŠçŸ¥ã‚‰ã›
            </h3>
            <div class="space-y-3">
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2">ğŸ‰ ä¼šå“¡ç™»éŒ²å®Œäº†</h4>
                    <p class="text-white/80 text-sm">
                        å®ˆè­·ç¥å ã„ã®ä¼šå“¡ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚æ§˜ã€…ãªæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚
                    </p>
                </div>
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2">âœ¨ æ–°æ©Ÿèƒ½è¿½åŠ </h4>
                    <p class="text-white/80 text-sm">
                        ç›¸è«‡ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚å®ˆè­·ç¥ã«ç›´æ¥ç›¸è«‡ã§ãã¾ã™ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            loadUserInfo();
        });

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿
        async function loadUserInfo() {
            try {
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
                const urlParams = new URLSearchParams(window.location.search);
                const email = urlParams.get('email');
                
                if (email) {
                    document.getElementById('userEmail').textContent = email;
                    
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°æƒ…å ±ã‚’å–å¾—
                    const response = await fetch(`/api/save-user-profile?email=${encodeURIComponent(email)}`);
                    const data = await response.json();
                    
                    if (data.success && data.user) {
                        displayUserInfo(data.user);
                    } else {
                        displayDefaultUserInfo(email);
                    }
                } else {
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ï¼ˆå°†æ¥çš„ãªå®Ÿè£…ï¼‰
                    displayDefaultUserInfo('ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼');
                }
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                displayDefaultUserInfo('ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼');
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
        function displayUserInfo(user) {
            const userInfo = document.getElementById('userInfo');
            
            let birthdate = 'æœªè¨­å®š';
            if (user.birth_year && user.birth_month && user.birth_day) {
                birthdate = `${user.birth_year}å¹´${user.birth_month}æœˆ${user.birth_day}æ—¥`;
            }

            userInfo.innerHTML = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-envelope text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> ${user.user_id || 'æœªè¨­å®š'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-birthday-cake text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ç”Ÿå¹´æœˆæ—¥:</strong> ${birthdate}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-crown text-white/70 mr-3"></i>
                        <span class="text-white"><strong>å®ˆè­·ç¥:</strong> ${user.guardian_name || 'æœªè¨­å®š'}</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-heart text-white/70 mr-3"></i>
                        <span class="text-white"><strong>æ‚©ã¿ã®ç¨®é¡:</strong> ${user.worry_type || 'æœªè¨­å®š'}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-calendar text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ç™»éŒ²æ—¥:</strong> ${formatDate(user.created_at)}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-400 mr-3"></i>
                        <span class="text-white"><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ç™»éŒ²å®Œäº†</span>
                    </div>
                </div>
            `;
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
        function displayDefaultUserInfo(email) {
            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-envelope text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> ${email}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-info-circle text-white/70 mr-3"></i>
                        <span class="text-white"><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ä¼šå“¡ç™»éŒ²æ¸ˆã¿</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <i class="fas fa-star text-yellow-400 mr-3"></i>
                        <span class="text-white"><strong>ä¼šå“¡ç‰¹å…¸:</strong> å…¨æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½</span>
                    </div>
                </div>
            `;
        }

        // è¨­å®šç”»é¢ã®è¡¨ç¤º
        function showSettings() {
            alert('è¨­å®šæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ã€‚\n\nä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ äºˆå®šã§ã™ï¼š\nâ€¢ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®å¤‰æ›´\nâ€¢ é€šçŸ¥è¨­å®š\nâ€¢ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤');
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
        function logout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                localStorage.removeItem('userData');
                
                // ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = '/';
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatDate(dateString) {
            if (!dateString) return 'æœªè¨­å®š';
            return new Date(dateString).toLocaleDateString('ja-JP');
        }
    </script>
</body>
</html>