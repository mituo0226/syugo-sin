<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒãƒ£ãƒƒãƒˆãƒ†ã‚¹ãƒˆ - å®ˆè­·ç¥å ã„</title>
  <meta name="description" content="ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆç”¨ãƒšãƒ¼ã‚¸ï¼ˆåˆ¶é™æ™‚é–“ãªã—ï¼‰">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="./consult/chat.css">
  <style>
    /* ãƒ†ã‚¹ãƒˆç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
    .test-header {
      background: linear-gradient(135deg, #66ccff, #3399ff);
      color: #000;
      padding: 15px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(102, 204, 255, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .test-info {
      background: rgba(255, 193, 7, 0.1);
      border: 2px solid rgba(255, 193, 7, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      color: #ffc107;
    }
    
    .test-info h3 {
      margin: 0 0 10px 0;
      color: #ffc107;
    }
    
    .test-info p {
      margin: 5px 0;
      font-size: 14px;
    }
    
    .localstorage-status {
      background: rgba(102, 204, 255, 0.1);
      border: 1px solid rgba(102, 204, 255, 0.3);
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      font-size: 12px;
      color: #66ccff;
    }
    
    .setup-buttons {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .setup-button {
      padding: 10px 15px;
      background: linear-gradient(90deg, #9d4edd, #7b2cbf);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .setup-button:hover {
      background: linear-gradient(90deg, #b565f0, #9d4edd);
      transform: translateY(-2px);
    }
    
    .setup-button.secondary {
      background: linear-gradient(90deg, #66ccff, #3399ff);
    }
    
    .setup-button.secondary:hover {
      background: linear-gradient(90deg, #99e0ff, #66ccff);
    }
    
    .setup-button.warning {
      background: linear-gradient(90deg, #ff6b6b, #ee5a52);
    }
    
    .setup-button.warning:hover {
      background: linear-gradient(90deg, #ff8787, #ff6b6b);
    }
    
    /* ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ */
    .chat-container {
      margin-top: 20px;
    }
    
    /* ã‚¿ã‚¤ãƒãƒ¼éƒ¨åˆ†ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«èª¿æ•´ */
    .timer-section {
      background: rgba(255, 193, 7, 0.1) !important;
      border: 2px solid rgba(255, 193, 7, 0.3) !important;
    }
    
    .timer-text {
      color: #ffc107 !important;
      font-weight: bold;
    }
    
    /* ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ± */
    .debug-panel {
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .debug-panel h4 {
      color: #66ccff;
      margin: 0 0 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="test-header">
      <h1>ğŸ§ª ãƒãƒ£ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</h1>
      <p>åˆ¶é™æ™‚é–“ãªã—ã§ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼ˆé¾ã¨ã®ä¼šè©±ï¼‰</p>
    </div>
    
    <!-- ãƒ†ã‚¹ãƒˆæƒ…å ± -->
    <div class="test-info">
      <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆè¨­å®šæƒ…å ±</h3>
      <p><strong>ç”Ÿå¹´æœˆæ—¥:</strong> 1962å¹´2æœˆ26æ—¥</p>
      <p><strong>å®ˆè­·ç¥:</strong> è™šç©ºè”µè©è–©</p>
      <p><strong>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ :</strong> ã¿ã¤ãŠ</p>
      <p><strong>èˆˆå‘³ã‚ã‚‹ç›¸è«‡:</strong> æ‹æ„›</p>
      <p><strong>åˆ¶é™æ™‚é–“:</strong> ãªã—ï¼ˆç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰ï¼‰</p>
    </div>
    
    <!-- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ -->
    <div class="localstorage-status" id="localStorageStatus">
      <strong>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹:</strong> ç¢ºèªä¸­...
    </div>
    
    <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ -->
    <div class="setup-buttons">
      <button class="setup-button" onclick="setupTestData()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š</button>
      <button class="setup-button secondary" onclick="clearAllData()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
      <button class="setup-button secondary" onclick="checkLocalStorage()">ğŸ” çŠ¶æ…‹ç¢ºèª</button>
      <button class="setup-button warning" onclick="toggleUnlimitedMode()">â° ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</button>
    </div>
    
    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel" id="debugPanel">
      <h4>ğŸ”§ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h4>
      <div id="debugContent">ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤ºä¸­...</div>
    </div>
    
    <!-- ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="chat-container">
      <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
      <div class="timer-section">
        <div class="timer-text" id="timerText">åˆ¶é™æ™‚é–“: ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰</div>
      </div>
      
      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div class="messages" id="messages">
        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
      </div>
      
      <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
      <div class="input-area">
        <div class="input-container">
          <textarea 
            id="messageInput" 
            placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
            rows="1"
            maxlength="1000"
          ></textarea>
          <button id="sendButton" class="send-button">é€ä¿¡</button>
        </div>
      </div>
    </div>
    
    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div style="text-align: center; margin: 20px 0;">
      <a href="./index.html" class="setup-button">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
      <a href="./test-payment.html" class="setup-button secondary" style="margin-left: 10px;">æ±ºæ¸ˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã¸</a>
    </div>
  </div>

  <script>
    // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
    const testUserData = {
      nickname: 'ã¿ã¤ãŠ',
      year: 1962,
      month: 2,
      day: 26,
      guardian: 'è™šç©ºè”µè©è–©',
      guardianKey: 'kokuzou',
      worry: 'æ‹æ„›',
      question: 'æ‹æ„›'
    };
    
    // ãƒãƒ£ãƒƒãƒˆé–¢é€£ã®å¤‰æ•°
    let unlimitedMode = true; // ãƒ†ã‚¹ãƒˆç”¨ãªã®ã§ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹
    let messages = [];
    let isTyping = false;
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
    window.addEventListener('load', function() {
      console.log('ãƒãƒ£ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
      
      // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
      setupTestData();
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ã‚’ç¢ºèª
      checkLocalStorage();
      
      // ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’åˆæœŸåŒ–
      initializeChat();
      
      // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      setTimeout(() => {
        addSystemMessage('ğŸ§ª ãƒãƒ£ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');
        addSystemMessage('åˆ¶é™æ™‚é–“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è‡ªç”±ã«é¾ã¨ä¼šè©±ã—ã¦ãã ã•ã„ã€‚');
        addSystemMessage('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ : ã¿ã¤ãŠ | å®ˆè­·ç¥: è™šç©ºè”µè©è–© | ç›¸è«‡å†…å®¹: æ‹æ„›');
      }, 1000);
    });
    
    // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
    function setupTestData() {
      try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
        localStorage.setItem('userData', JSON.stringify(testUserData));
        
        // ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
        localStorage.setItem('unlimitedMode', 'true');
        
        console.log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ:', testUserData);
        updateDebugInfo('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ');
        
      } catch (error) {
        console.error('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
        updateDebugInfo('âŒ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
    
    // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
    function clearAllData() {
      try {
        localStorage.clear();
        messages = [];
        document.getElementById('messages').innerHTML = '';
        console.log('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        updateDebugInfo('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å†è¨­å®š
        setTimeout(() => {
          setupTestData();
        }, 500);
        
      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:', error);
        updateDebugInfo('âŒ ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹ã‚’ç¢ºèª
    function checkLocalStorage() {
      const statusDiv = document.getElementById('localStorageStatus');
      
      try {
        const userData = localStorage.getItem('userData');
        const unlimitedMode = localStorage.getItem('unlimitedMode');
        
        let status = '<strong>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹:</strong><br>';
        
        if (userData) {
          const parsed = JSON.parse(userData);
          status += `âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿: ${parsed.nickname} (${parsed.year}/${parsed.month}/${parsed.day})<br>`;
        } else {
          status += 'âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿: æœªè¨­å®š<br>';
        }
        
        if (unlimitedMode === 'true') {
          status += 'âœ… ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰: æœ‰åŠ¹<br>';
        } else {
          status += 'âŒ ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰: ç„¡åŠ¹<br>';
        }
        
        statusDiv.innerHTML = status;
        
      } catch (error) {
        statusDiv.innerHTML = '<strong>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹:</strong> âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
        console.error('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      }
    }
    
    // ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
    function toggleUnlimitedMode() {
      unlimitedMode = !unlimitedMode;
      localStorage.setItem('unlimitedMode', unlimitedMode.toString());
      
      const timerText = document.getElementById('timerText');
      if (unlimitedMode) {
        timerText.textContent = 'åˆ¶é™æ™‚é–“: ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰';
        timerText.style.color = '#ffc107';
        updateDebugInfo('â° ç„¡åˆ¶é™ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
      } else {
        timerText.textContent = 'åˆ¶é™æ™‚é–“: åˆ¶é™ã‚ã‚Š';
        timerText.style.color = '#66ccff';
        updateDebugInfo('â° åˆ¶é™æ™‚é–“ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
      }
    }
    
    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æ›´æ–°
    function updateDebugInfo(message) {
      const debugContent = document.getElementById('debugContent');
      const timestamp = new Date().toLocaleTimeString();
      debugContent.innerHTML += `[${timestamp}] ${message}<br>`;
      debugContent.scrollTop = debugContent.scrollHeight;
    }
    
    // ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®åˆæœŸåŒ–
    function initializeChat() {
      const messageInput = document.getElementById('messageInput');
      const sendButton = document.getElementById('sendButton');
      
      // é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
      sendButton.addEventListener('click', sendMessage);
      
      // Enterã‚­ãƒ¼ã§ã®é€ä¿¡
      messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•ãƒªã‚µã‚¤ã‚º
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      });
    }
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    async function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      const message = messageInput.value.trim();
      
      if (!message || isTyping) return;
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
      addMessage(message, 'user');
      messageInput.value = '';
      messageInput.style.height = 'auto';
      
      // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹åŒ–
      setInputEnabled(false);
      
      // é¾ã®è¿”ä¿¡ã‚’ç”Ÿæˆ
      await generateDragonResponse(message);
      
      // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–
      setInputEnabled(true);
    }
    
    // é¾ã®è¿”ä¿¡ã‚’ç”Ÿæˆ
    async function generateDragonResponse(userMessage) {
      isTyping = true;
      addSystemMessage('ğŸ‰ é¾ãŒè€ƒãˆã¦ã„ã¾ã™...');
      
      try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        
        // é¾ã®è¿”ä¿¡ã‚’ç”Ÿæˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ã®ç°¡æ˜“ç‰ˆï¼‰
        const response = await generateTestResponse(userMessage, userData);
        
        // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        removeLastSystemMessage();
        
        // é¾ã®è¿”ä¿¡ã‚’è¿½åŠ 
        addMessage(response, 'assistant');
        
        updateDebugInfo(`ğŸ‰ é¾ã®è¿”ä¿¡ã‚’ç”Ÿæˆ: ${response.substring(0, 50)}...`);
        
      } catch (error) {
        console.error('é¾ã®è¿”ä¿¡ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        removeLastSystemMessage();
        addMessage('ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ä¸€æ™‚çš„ã«è¿”ä¿¡ã§ãã¾ã›ã‚“ã€‚', 'assistant');
        updateDebugInfo(`âŒ é¾ã®è¿”ä¿¡ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
      } finally {
        isTyping = false;
      }
    }
    
    // ãƒ†ã‚¹ãƒˆç”¨ã®è¿”ä¿¡ç”Ÿæˆ
    async function generateTestResponse(userMessage, userData) {
      // 2-4ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå¾…æ©Ÿæ™‚é–“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
      await new Promise(resolve => setTimeout(resolve, Math.random() * 2000 + 2000));
      
      const responses = [
        `ã¿ã¤ãŠæ§˜ã€è™šç©ºè”µè©è–©ã®å°ãã«ã‚ˆã‚Šã€ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ãŠç­”ãˆã„ãŸã—ã¾ã™ã€‚${userMessage}ã«ã¤ã„ã¦ã§ã™ãŒã€å¿ƒã®å¥¥ã«ã‚ã‚‹çœŸå®Ÿã‚’è¦‹ã¤ã‚ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚`,
        `é¾ã®ç›®ã‹ã‚‰è¦‹ã‚‹ã¨ã€ã¿ã¤ãŠæ§˜ã®æ‹æ„›é‹ã¯ä¸Šæ˜‡å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚${userMessage}ã«é–¢ã—ã¦ã€ç›¸æ‰‹ã®å¿ƒã‚’ç†è§£ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„ã€‚`,
        `1962å¹´ç”Ÿã¾ã‚Œã®ã¿ã¤ãŠæ§˜ã€è™šç©ºè”µè©è–©ãŒã‚ãªãŸã®æ‹æ„›ã‚’å®ˆè­·ã—ã¦ãŠã‚Šã¾ã™ã€‚${userMessage}ã«ã¤ã„ã¦ã€ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`,
        `ã¿ã¤ãŠæ§˜ã®æ‹æ„›ã«ã¤ã„ã¦ã€é¾ãŒãŠç­”ãˆã„ãŸã—ã¾ã™ã€‚${userMessage}ã«é–¢ã—ã¦ã€ã¾ãšè‡ªåˆ†è‡ªèº«ã®å¿ƒã‚’æ•´ãˆã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`,
        `è™šç©ºè”µè©è–©ã®åŠ è­·ã®ã‚‚ã¨ã€ã¿ã¤ãŠæ§˜ã®æ‹æ„›é‹å‹¢ã‚’è¦‹é€šã—ã¦ãŠã‚Šã¾ã™ã€‚${userMessage}ã«ã¤ã„ã¦ã€èª å®Ÿãªæ°—æŒã¡ã§æ¥ã™ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã¨ãªã‚Šã¾ã™ã€‚`
      ];
      
      return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
    function addMessage(content, sender) {
      const messagesContainer = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const time = new Date().toLocaleTimeString();
      
      messageDiv.innerHTML = `
        <div class="message-content">${content}</div>
        <div class="message-time">${time}</div>
      `;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      messages.push({
        content: content,
        sender: sender,
        timestamp: new Date().toISOString()
      });
      
      updateDebugInfo(`ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ : ${sender} - ${content.substring(0, 30)}...`);
    }
    
    // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
    function addSystemMessage(content) {
      const messagesContainer = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message system';
      messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      updateDebugInfo(`ğŸ”” ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${content}`);
    }
    
    // æœ€å¾Œã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
    function removeLastSystemMessage() {
      const messagesContainer = document.getElementById('messages');
      const systemMessages = messagesContainer.querySelectorAll('.message.system');
      if (systemMessages.length > 0) {
        const lastSystemMessage = systemMessages[systemMessages.length - 1];
        lastSystemMessage.remove();
      }
    }
    
    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    function setInputEnabled(enabled) {
      const messageInput = document.getElementById('messageInput');
      const sendButton = document.getElementById('sendButton');
      
      messageInput.disabled = !enabled;
      sendButton.disabled = !enabled;
      
      if (enabled) {
        messageInput.focus();
      }
    }
    
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    window.addEventListener('error', function(event) {
      console.error('JavaScript ã‚¨ãƒ©ãƒ¼:', event.error);
      updateDebugInfo(`âŒ JavaScript ã‚¨ãƒ©ãƒ¼: ${event.error.message}`);
    });
    
    // æœªå‡¦ç†ã®Promise rejectionã‚’ã‚­ãƒ£ãƒƒãƒ
    window.addEventListener('unhandledrejection', function(event) {
      console.error('æœªå‡¦ç†ã®Promise rejection:', event.reason);
      updateDebugInfo(`âŒ Promise rejection: ${event.reason}`);
      event.preventDefault();
    });
  </script>
</body>
</html>
